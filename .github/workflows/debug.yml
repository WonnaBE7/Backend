name: Debug Server Status

on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ìš©

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ” ì„œë²„ ìƒíƒœ ì „ì²´ ì ê²€
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ${{ secrets.EC2_USERNAME }}
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            echo "ğŸ” ì„œë²„ ì „ì²´ ìƒíƒœ ì ê²€ ì‹œì‘..."
            echo "========================================"
            
            echo "ğŸ“‹ ì‹œìŠ¤í…œ ì •ë³´:"
            uname -a
            whoami
            pwd
            
            echo "ğŸ“‹ Tomcat ê´€ë ¨ ë””ë ‰í† ë¦¬ ê²€ìƒ‰:"
            sudo find / -name "*tomcat*" -type d 2>/dev/null | head -20
            
            echo "ğŸ“‹ webapps ë””ë ‰í† ë¦¬ ê²€ìƒ‰:"
            sudo find / -name "webapps" -type d 2>/dev/null
            
            echo "ğŸ“‹ Tomcat í”„ë¡œì„¸ìŠ¤:"
            ps aux | grep tomcat | grep -v grep || echo "Tomcat í”„ë¡œì„¸ìŠ¤ ì—†ìŒ"
            
            echo "ğŸ“‹ systemctl ì„œë¹„ìŠ¤ ìƒíƒœ:"
            sudo systemctl status tomcat || echo "tomcat ì„œë¹„ìŠ¤ ì—†ìŒ"
            sudo systemctl status tomcat9 || echo "tomcat9 ì„œë¹„ìŠ¤ ì—†ìŒ"
            sudo systemctl status tomcat8 || echo "tomcat8 ì„œë¹„ìŠ¤ ì—†ìŒ"
            
            echo "ğŸ“‹ 8080 í¬íŠ¸ ì‚¬ìš© í˜„í™©:"
            sudo netstat -tulpn | grep :8080 || echo "8080 í¬íŠ¸ ì‚¬ìš© ì—†ìŒ"
            
            echo "ğŸ“‹ Java ì„¤ì¹˜ í™•ì¸:"
            java -version 2>&1 || echo "Java ì—†ìŒ"
            which java || echo "Java ê²½ë¡œ ì—†ìŒ"
            
            echo "ğŸ“‹ í˜„ì¬ GitHub Secrets TOMCAT_PATH í™•ì¸:"
            echo "TOMCAT_PATH ì„¤ì •ê°’: ${{ secrets.TOMCAT_PATH }}"
            if [ -d "${{ secrets.TOMCAT_PATH }}" ]; then
              echo "âœ… TOMCAT_PATH ë””ë ‰í† ë¦¬ ì¡´ì¬"
              sudo ls -la "${{ secrets.TOMCAT_PATH }}/"
              if [ -d "${{ secrets.TOMCAT_PATH }}/webapps" ]; then
                echo "âœ… webapps ë””ë ‰í† ë¦¬ ì¡´ì¬"
                sudo ls -la "${{ secrets.TOMCAT_PATH }}/webapps/"
              else
                echo "âŒ webapps ë””ë ‰í† ë¦¬ ì—†ìŒ"
              fi
            else
              echo "âŒ TOMCAT_PATH ë””ë ‰í† ë¦¬ ì—†ìŒ"
            fi
            
            echo "ğŸ“‹ ë¡œê·¸ íŒŒì¼ ê²€ìƒ‰:"
            sudo find / -name "catalina.out" 2>/dev/null || echo "catalina.out ì—†ìŒ"
            sudo find / -name "*tomcat*log*" 2>/dev/null | head -10
            
            echo "ğŸ“‹ ì¼ë°˜ì ì¸ Tomcat ê²½ë¡œë“¤ í™•ì¸:"
            for path in "/opt/tomcat" "/var/lib/tomcat9" "/usr/share/tomcat9" "/home/tomcat" "/opt/apache-tomcat"; do
              if [ -d "$path" ]; then
                echo "âœ… $path ì¡´ì¬"
                sudo ls -la "$path/" | head -10
              else
                echo "âŒ $path ì—†ìŒ"
              fi
            done
            
            echo "========================================"
            echo "ğŸ” ì„œë²„ ìƒíƒœ ì ê²€ ì™„ë£Œ"